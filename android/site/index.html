<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="./img/favicon.ico">

	<title>Locarta Android SDK Documentation</title>

        <link href="./css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="./css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="./css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body class="homepage">

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href=".">Locarta Android SDK Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="active">
                        <a href=".">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="unity/">Unity Guide</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li class="disabled">
                        <a rel="next" >
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="unity/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#locarta-android-sdk">Locarta Android SDK</a></li>
        
            <li><a href="#setup">Setup</a></li>
        
            <li><a href="#integration-information">Integration Information</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="locarta-android-sdk">Locarta Android SDK</h1>
<table>
<thead>
<tr>
<th>Latest Version</th>
<th>Size</th>
<th>Minimal Android API version</th>
<th>Release Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.3.0</td>
<td>457 KB</td>
<td>7 (2.1  Eclair)</td>
<td>31/10/2016</td>
</tr>
</tbody>
</table>
<h2 id="setup">Setup</h2>
<hr />
<h3 id="1-declare-dependencies">1) Declare dependencies</h3>
<p>Open the <code>app/build.gradle</code> file of your project and update the repository and dependency blocks as follows:</p>
<pre><code class="gradle">     repositories {
        // ... other project repositories
        maven {
            url &quot;http://nexus.locarta.co/content/repositories/android-sdk/&quot;
            credentials {
               username = &quot;$YOUR_USERNAME$&quot;
               password = &quot;$YOUR_PASSWORD$&quot;
            }
        }
        // Repository will be provided separately
     }

     // ...
     dependencies {
        // ... other project dependencies
        // We recommend to set version as: 1.3.+
        compile (&quot;co.locarta:locarta-sdk:$LOCARTA_SDK_VERSION$:pubProd@aar&quot;) {
            transitive = true;
        }
     }
</code></pre>

<p>Where <code>$YOUR_USERNAME$</code> and <code>$YOUR_PASSWORD$</code> are the credentials to the nexus repository.
<em>They match with the credentials you got to get access to this documentation</em>.</p>
<p><code>$LOCARTA_SDK_VERSION$</code> is the SDK version number you wish to use.
Sync <code>build.gradle</code>, rebuild your project and import <code>co.locarta.sdk.LocartaSDK</code> into your app.</p>
<h3 id="2-set-publisher-key">2) Set Publisher Key</h3>
<p>Add a <code>&lt;meta-data&gt;</code> tag to the <code>AndroidManifest.xml</code> of your project:</p>
<pre><code class="xml">    &lt;application&gt;
        &lt;!-- other content --&gt;
        &lt;meta-data
               android:name=&quot;co.locarta.sdk.pid&quot;
               android:value=&quot;YOUR_PUBLISHER_ID&quot; /&gt;        
    &lt;/application&gt;
</code></pre>

<p>where <code>YOUR_PUBLISHER_ID</code> is your Locarta publisher id.</p>
<h3 id="3-initialize-sdk-on-app-start">3) Initialize SDK on App Start</h3>
<p><strong>Please call the initialization method only in the application class.</strong></p>
<p>Also notice that the SDK already starts a new thread for the initialization. Hence there is no need to put the init method in a new thread.</p>
<p>Example:</p>
<pre><code class="java">    // Add this line to the header of your file
    import co.locarta.sdk.LocartaSdk;

    public class SdkDemoApplication extends Application {
        @Override
        public void onCreate() {
            super.onCreate();
            // Initialise SDK on App creation
            LocartaSdk.initialize(getApplicationContext());
        }
    }

</code></pre>

<h3 id="4-obtain-user-opt-in">4) Obtain User Opt-In</h3>
<p>The SDK will not start working until the user has opted in – this needs to be done only once per user. There are two ways to do it, depending on how the opt-in is gathered:</p>
<p>a) Implicit opt-in (if you've added Locarta info to your app's privacy policy):</p>
<pre><code class="java">    // Put this code in your Application.onCreate() function, after LocartaSdk.initialize()
    if(!LocartaSdk.isAgreementAccepted(getContext())) {
        LocartaSdk.setAgreementAccepted(getContext(), true);
    }
</code></pre>

<p>a) Explicit opt-in (if you want to show a popup agreement dialog prompting users to opt in):</p>
<pre><code class="java">    // Put this code somewhere in the main activities to show the dialog
    LocartaSdk.showAgreementDialog(getActivity());
</code></pre>

<p>If you want to check whether the user has opted in, call:</p>
<pre><code class="java">    // The call returns true or false if user accepted terms or not
    LocartaSdk.isAgreementAccepted(getContext());        
</code></pre>

<p>You can also check whether user saw an agreement dialog:</p>
<pre><code class="java">    // The call returns TermStatus enum
    LocartaSdk.getAgreementStatus(getContext());
</code></pre>

<h3 id="5-user-opt-out">5) User Opt-Out</h3>
<p>If you need to turn off SDK manually and do not allow it to restart, you can use the following method:</p>
<pre><code class="java">   LocartaSdk.setAgreementAccepted(getContext(), false);
</code></pre>

<h3 id="6-push-notifications">6) Push notifications</h3>
<p>If you use Google Cloud Messaging to send push notifications to your application, please
call this method to split the SDK's notifications from yours:</p>
<pre><code class="java">   // Returns *true* if push notification is addressed to SDK
   LocartaSdk.handleMessage(Bundle bundle);
</code></pre>

<p>Please ignore the push notifications addressed to the SDK in your receiver:</p>
<pre><code class="java">public class AppGcmListenerService extends GcmListenerService {

    @Override
    public void onMessageReceived(String from, Bundle bundle) {
        if (!LocartaSdk.handleMessage(bundle)) {
          // Normal push notification, your logic comes here
            Log.i(&quot;AppGcmListenerService&quot;, String.format(&quot;Received message from %s with data %s&quot;, from, bundle));
        } else {
          // just ignore this push notification, it is addressed to the SDK
        }
    }

}
</code></pre>

<h2 id="integration-information">Integration Information</h2>
<hr />
<p>By default the host app <strong>should not</strong> be setting any additional permissions in its manifest.</p>
<p>In case Target SDK Version &gt;= 23 we rely on the fact that <code>Access Fine Location</code> / <code>Access Coarse Location</code> permisions are handeled by the host app (e.g. pop-out permission dialog is shown to the user).</p>
<p>The set of minimal permissions embedded in the Locarta SDK is:</p>
<table>
<thead>
<tr>
<th>Permission Name</th>
<th>Plain English Name in App</th>
<th>Plain German Name in App</th>
</tr>
</thead>
<tbody>
<tr>
<td>android.permission.INTERNET</td>
<td>Full network access</td>
<td>Zugriff auf alle Netzwerke</td>
</tr>
<tr>
<td>android.permission.ACCESS_FINE_LOCATION</td>
<td>Precise location</td>
<td>Genauer Standort</td>
</tr>
<tr>
<td>android.permission.ACCESS_COARSE_LOCATION</td>
<td>Approximate location</td>
<td>Ungefährer Standort</td>
</tr>
<tr>
<td>android.permission.ACCESS_NETWORK_STATE</td>
<td>View network connections</td>
<td>Netzwerkverbindungen abrufen</td>
</tr>
<tr>
<td>android.permission.ACCESS_WIFI_STATE</td>
<td>View wifi connections</td>
<td>WLAN-Verbindungen abrufen</td>
</tr>
<tr>
<td>android.permission.CHANGE_WIFI_STATE</td>
<td>Connect and disconnect from Wi-Fi</td>
<td>WLAN-Verbindungen herstellen und trennen</td>
</tr>
</tbody>
</table>
<h3 id="proguard">Proguard</h3>
<p>Proguard rules are already configured for the Locarta SDK. No additional steps need to be taken in your application.</p>
<h3 id="performance-impact">Performance Impact</h3>
<p>We expect a battery impact of roughly 2-3%.</p>
<p>Normally we use about 1MB/week of mobile data (depending on how long the phone is connected to wifi).</p>
<h3 id="3rd-party-dependencies">3rd-Party Dependencies</h3>
<p>The Locarta SDK should be implemented as a transitive @aar dependency. These are the 3rd-party dependencies it uses:</p>
<table>
<thead>
<tr>
<th>Dependency</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>com.google.android.gms:play-services-location</td>
<td>9.8.0</td>
</tr>
<tr>
<td>com.google.android.gms:play-services-gcm</td>
<td>9.8.0</td>
</tr>
<tr>
<td>com.google.code.gson:gson</td>
<td>2.7</td>
</tr>
<tr>
<td>io.reactivex:rxjava</td>
<td>1.1.8</td>
</tr>
<tr>
<td>com.squareup.retrofit2:retrofit</td>
<td>2.1.0</td>
</tr>
<tr>
<td>com.squareup.retrofit2:converter-gson</td>
<td>2.1.0</td>
</tr>
<tr>
<td>de.greenrobot:eventbus</td>
<td>3.0.0</td>
</tr>
<tr>
<td>com.google.dagger:dagger</td>
<td>2.7</td>
</tr>
<tr>
<td>ch.hsr:geohash</td>
<td>1.0.13</td>
</tr>
<tr>
<td>com.google.protobuf-java</td>
<td>3.0.0</td>
</tr>
</tbody>
</table>
<h4 id="exclude-dependencies">Exclude dependencies</h4>
<p>If you're using one of the libraries listed above and want to use the most recent version of it, you can force the build system to choose it rather than using the one built into the SDK. For example if you want to force using the recent Play Services library add the Locarta SDK's dependency like this:</p>
<pre><code class="gradle">dependencies {
   compile (&quot;co.locarta:locarta-sdk:$LOCARTA_SDK_VERSION$:pubProd@aar&quot;) {
       transitive = true;
       exclude group: &quot;com.google.android.gms&quot;, module: &quot;play-services-gcm&quot;
       exclude group: &quot;com.google.android.gms&quot;, module: &quot;play-services-location&quot;
   }

   compile &quot;com.google.android.gms:play-services-gcm:$PLAY_SERVICES_VERSION$&quot;
   compile &quot;com.google.android.gms:play-services-location:$PLAY_SERVICES_VERSION$&quot;
}  
</code></pre>

<p>Use the same way for others dependencies such as RxJava etc.</p>
<hr />
<h3 id="troubleshooting">Troubleshooting</h3>
<h4 id="proguard_1">Proguard</h4>
<p>If you see the message: <code>Can't find referenced class from the SDK</code>, add these lines to your proguard configuration:</p>
<pre><code>-dontwarn co.pointwise.proto.JournalProto$.**
-dontwarn com.google.common.base.Function
-dontwarn com.google.common.collect.Lists
-dontwarn com.google.common.io.BaseEncoding
</code></pre>

<h4 id="downgrading-min-sdk-version-to-api-v7">Downgrading min SDK version to API v7</h4>
<p>Technically the minimum API version for the SDK is already v7. However, it depends on Google Play Services, which requires minimum API v9.</p>
<p>If you get an error saying:</p>
<pre><code>Manifest merger failed : uses-sdk:minSdkVersion 7 cannot be smaller than version 9 declared in library [com.google.android.gms:play-services-location:9.4.0] Suggestion: use tools:overrideLibrary=&quot;com.google.android.gms&quot; to force usage
</code></pre>

<p>Then add this line to the manifest of your application:</p>
<pre><code class="xml">&lt;uses-sdk tools:overrideLibrary=&quot;com.google.android.gms, com.google.android.gms.base, com.google.android.gms.tasks, com.google.android.gms.gcm, com.google.android.gms.iid&quot;/&gt;
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.0.3.min.js"></script>
        <script src="./js/highlight.pack.js"></script>
        <script>var base_url = '.';</script>
        <script data-main="./mkdocs/js/search.js" src="./mkdocs/js/require.js"></script>
        <script src="./js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2016-11-18 12:46:15.079423
-->
